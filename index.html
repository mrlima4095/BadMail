<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlainPost</title>


    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        async function conectar(acao) {
            const token = localStorage.getItem("Mail-Token");
            if (!token) { window.location.href = "login"; return; }

            const payload = { action: acao };

            try { 
                const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": localStorage.getItem("Mail-Token") }, body: JSON.stringify(payload), }); 
                const dados = await resposta.json(); 

                return dados.response; 
            } catch (erro) { return "9"; }
        }


        window.onload = () => {
            const token = localStorage.getItem("Mail-Token");
            if (!token) { window.location.href = "login"; return; }

            document.getElementById("read").addEventListener("click", async () => { 
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                try { 
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "read" }), }); 
                    const dados = await resposta.json(); 

                    if (resposta.status === 200) { Swal.fire({ icon: "info", title: "Mensagens", html: dados.response.replaceAll("\\n", "<br>").replaceAll("\n", "<br>"), }); } 
                    else { Swal.fire('Erro', 'Erro ao ler mensagens.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); }
            });  
            document.getElementById("send").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: target } = await Swal.fire({ title: 'Destinatário:', input: 'text', inputPlaceholder: 'Nome do usuário', showCancelButton: true, });
                if (!target) return Swal.fire('Erro', 'Destinatário não pode estar vazio!', 'error');

                const { value: content } = await Swal.fire({ title: 'Mensagem:', input: 'text', inputPlaceholder: 'Escreva sua mensagem', showCancelButton: true, });
                if (!content) return Swal.fire('Erro', 'Você não pode mandar uma mensagem vazia!', 'error');

                const payload = { action: "send", to: target, content };

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify(payload), });
                    const dados = await resposta.json();

                    if (resposta.status === 200) Swal.fire('Sucesso', 'Sua mensagem foi enviada!', 'success');
                    else if (resposta.status === 404) Swal.fire('Erro', 'O destinatário não foi encontrado!', 'error');
                    else { Swal.fire('Erro', 'Erro ao enviar mensagem.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); }
            });
            document.getElementById("clear").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const confirm = await Swal.fire({ title: 'Tem certeza?', text: 'Tem certeza que deseja limpar suas mensagens?', icon: 'warning', showCancelButton: true, confirmButtonText: 'Sim', cancelButtonText: 'Cancelar' });
                if (!confirm.isConfirmed) { return; }

                try { 
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": localStorage.getItem("Mail-Token") }, body: JSON.stringify({ action: "clear" }), }); 
                    
                    if (resposta.status === 200) { Swal.fire('Sucesso', 'Suas mensagens foram apagadas!', 'success'); }
                    else { Swal.fire('Erro', 'Erro ao limpar mensagens.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); } 
            });
            document.getElementById("transfer").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: target } = await Swal.fire({ title: 'Destinatário:', input: 'text', inputPlaceholder: 'Nome do destinatário', showCancelButton: true, });
                if (!target) return Swal.fire('Erro', 'Destinatário não pode estar vazio!', 'error');

                const { value: amount } = await Swal.fire({ title: 'Quantidade:', input: 'number', inputPlaceholder: 'Quantas moedas?', showCancelButton: true, });
                if (!amount) return Swal.fire('Erro', 'Você precisa informar a quantidade!', 'error');

                const confirm = await Swal.fire({ title: 'Confirmar transferência', text: `Tem certeza que deseja enviar ${amount} moedas para ${target}?`, icon: 'question', showCancelButton: true, confirmButtonText: 'Sim', cancelButtonText: 'Cancelar' });

                if (!confirm.isConfirmed) return Swal.fire('Cancelado', 'Transferência cancelada.', 'info');


                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "transfer", to: target, amount }), });

                    if (resposta.status === 200) Swal.fire('Sucesso', 'Moedas enviadas!', 'success');
                    else if (resposta.status === 404) Swal.fire('Erro', 'O destinatário não foi encontrado!', 'error');
                    else if (resposta.response === 406) Swal.fire('Erro', 'A quantia de moedas a ser enviada é inválida!', 'error');
                    else if (resposta.status === 401) Swal.fire('Erro', 'Saldo insuficiente!', 'error');
                    else { Swal.fire('Erro', 'Erro ao transferir.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); } 
            });
            document.getElementById("search").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: user } = await Swal.fire({ title: 'Quem deseja procurar?', input: 'text', inputPlaceholder: 'Nome de usuário', showCancelButton: true, });
                if (!user) return Swal.fire('Erro', 'Insira um nome de usuario!', 'error');

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "search", user }), });
                    const dados = await resposta.json();

                    if (resposta.status === 200) { Swal.fire('Resultado', dados.response, 'info'); }
                    else if (resposta.status === 404) { Swal.fire('Erro', 'O usuário não foi encontrado!', 'error'); }
                    else { Swal.fire('Erro', 'Erro ao procurar.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); } 
            });

            document.getElementById("me").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: user } = await Swal.fire({ title: 'Quem deseja procurar?', input: 'text', inputPlaceholder: 'Nome de usuário', showCancelButton: true, });
                if (!user) return Swal.fire('Erro', 'Insira um nome de usuario!', 'error');

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "me", user }), });
                    const dados = await resposta.json();

                    if (resposta.status === 200) { Swal.fire('Seus dados', dados.response, 'info'); }
                    else { Swal.fire('Erro', 'Erro ao consultar.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); } 

            });
            document.getElementById("coins").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: user } = await Swal.fire({ title: 'Quem deseja procurar?', input: 'text', inputPlaceholder: 'Nome de usuário', showCancelButton: true, });
                if (!user) return Swal.fire('Erro', 'Insira um nome de usuario!', 'error');

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "coins", user }), });
                    const dados = await resposta.json();

                    if (resposta.status === 200) { Swal.fire('Suas moedas', dados.response, 'info') }
                    else { Swal.fire('Erro', 'Erro ao consultar.', 'error'); }
                } catch { Swal.fire('Erro', 'Erro na conexão.', 'error'); } 

            });
            document.getElementById("drive").addEventListener("click", () => { window.location.href = "/drive"; });
            document.getElementById("options").addEventListener("click", () => { window.location.href = "options"; });
            document.getElementById("security").addEventListener("click", () => { window.location.href = "security"; });
        };
    </script>

</head>
<body>
    <div id="conteiner">
        <h2>Social</h2><br>
        <button id="read" type="submit">Ler Mensagens</button>
        <button id="send" type="submit">Enviar Mensagens</button>
        <button id="clear" type="submit">Limpar Todas mensagens</button>
        <button id="transfer" type="submit">Enviar Moedas</button>
        <button id="search" type="submit">Procurar</button><br>

        <h2>Minha Conta</h2><br>
        <button id="me" type="submit">Meus Dados</button>
        <button id="coins" type="submit">Meu Saldo</button>
        <button id="drive" type="submit">BinDrop (Drive)</button>
        <button id="options" type="submit">Painel da Conta</button>
        <button id="security" type="submit">Ações de Segurança</button>
    <div>
</body>
</html>
