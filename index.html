<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlainPost</title>

    <link rel="stylesheet" href="style.css">
    <script type="text/javascript">
        async function conectar(acao) {
            const username = localStorage.getItem("username");
            const password = localStorage.getItem("password");

            if (!username || !password) { window.location.href = "login"; return; }

            const payload = { username, password, action: acao };

            try {
                const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload), });
                const dados = await resposta.json();

                return dados.response;
            } catch (erro) {
                return "9";
            }
        }

        async function send() {
            const username = localStorage.getItem("username");
            const password = localStorage.getItem("password");

            const target = prompt("Destinatário:").trim(); if (!target) return alert("Destinatário não pode estar vazio!");
            const content = prompt("Mensagem:").trim(); if (!content) return alert("Você não pode mandar uma mensagem vazia!");

            const payload = { username, password, action: "send", to: target, content, };

            try {
                const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload), });
                const dados = await resposta.json();

                if (dados.response === "0") alert("Sua mensagem foi enviada!");
                else if (dados.response === "4") alert("O destinatário não foi encontrado!");
                else alert("Erro ao enviar mensagem.");
            } catch { alert("Erro na conexão."); }
        }
        async function search() {
            const username = localStorage.getItem("username");
            const password = localStorage.getItem("password");

            const user = prompt("Quem deseja procurar?").trim(); if (!user) return alert("Insira um nome de usuario!");

            const payload = { username, password, action: "search", user, };

            try {
                const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload), });
                const dados = await resposta.json();

                if (dados.response === "4") alert("O usuario não foi encontrado!");
                else alert(dados.response);
            } catch { alert("Erro na conexão."); }
        }

        async function transfer() {
            const username = localStorage.getItem("username");
            const password = localStorage.getItem("password");

            const target = prompt("Destinatário:").trim(); if (!target) return alert("Destinatário não pode estar vazio!");
            const amount = prompt("Quantidade:").trim(); if (!amount) return alert("Você precisa informar a quantidade!");

            
            const payload = { username, password, action: "transfer", to: target, amount, };

            try {
                const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload), });
                const dados = await resposta.json();

                if (dados.response === "0") alert("Moedas enviadas!");
                else if (dados.response === "4") alert("O destinatário não foi encontrado!");
                else if (dados.response === "6") alert("A quantia de moedas a serem enviadas é invalida!")
                else if (dados.response === "7") alert("Saldo insuficiente!")
                else alert("Erro ao transferir.");
            } catch { alert("Erro na conexão."); }
        }

        window.onload = () => {
            if (!localStorage.getItem("username") || !localStorage.getItem("password")) { window.location.href = "login"; return; }

            document.getElementById("read").addEventListener("click", async () => { const r = await conectar("read"); alert(r); });
            document.getElementById("send").addEventListener("click", send); 
            document.getElementById("clear").addEventListener("click", async () => { 
                const confirm = window.confirm("Tem certeza que deseja limpar suas mensagens?");
                if (!confirm) return;

                const r = await conectar("clear"); 

                if (r === "0") alert("Suas mensagens foram apagadas!"); 
                else alert("Ocorreu um erro na conexão!"); });
            document.getElementById("transfer").addEventListener("click", transfer);
            document.getElementById("search").addEventListener("click", search);

            document.getElementById("me").addEventListener("click", async () => { const r = await conectar("me"); alert(r); });
            document.getElementById("coins").addEventListener("click", async () => { const r = await conectar("coins"); alert(r); });
            document.getElementById("security").addEventListener("click", () => { window.location.href = "security"; });
        };
    </script>
</head>
<body>
    <div id="conteiner">
        <h2>Social</h2>
        <button id="read" type="submit">Ler Mensagens</button>
        <button id="send" type="submit">Enviar Mensagens</button>
        <button id="clear" type="submit">Limpar Todas mensagens</button>
        <button id="transfer" type="submit">Enviar Moedas</button>
        <button id="search" type="submit">Procurar</button>

        <h2>Minha Conta</h2>
        <button id="me" type="submit">Meus Dados</button>
        <button id="coins" type="submit">Meu Saldo</button>
        <button id="security" type="submit">Ações de Segurança</button>
    <div>
</body>
</html>
