<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlainPost</title>


    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        window.onload = () => {
            const token = localStorage.getItem("Mail-Token");
            if (!token) { window.location.href = "login"; return; }

            document.getElementById("back").addEventListener("click", () => { window.location.href = "/mail"; });

            document.getElementById("changepass").addEventListener("click", async () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: newpass } = await Swal.fire({ title: "Trocar Senha", input: "password", inputPlaceholder: "Nova senha", showCancelButton: true  });
                if (!newpass) return;

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "changepass", newpass }), });

                    if (resposta.status === 200) { Swal.fire("Sucesso", "Senha alterada com sucesso!", "success"); } 
                    else { Swal.fire("Erro", "Erro ao trocar senha.", "error"); }
                } catch { Swal.fire("Erro", "Erro na conexão.", "error"); }
            });
            document.getElementById("signout").addEventListener("click", () => {
                const token = localStorage.getItem("Mail-Token");
                if (!token) { window.location.href = "login"; return; }

                const { value: newpass } = await Swal.fire({ title: "Trocar Senha", input: "password", inputPlaceholder: "Nova senha", showCancelButton: true  });
                if (!newpass) return;

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/logout", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ 
                        action: "logout"}), });

                    if (resposta.status === 200) { localStorage.getItem("Mail-Token"); window.location.href = "/mail"; } 
                    else { Swal.fire("Erro", "Erro ao encerrar sessão.", "error"); }
                } catch { Swal.fire("Erro", "Erro na conexão.", "error"); }
            });
            document.getElementById("signoff").addEventListener("click", async () => {
                const username = localStorage.getItem("username");
                const password = localStorage.getItem("password");

                const result = await Swal.fire({ title: "Tem certeza?", text: "Tem certeza que deseja apagar sua conta?", icon: "warning", showCancelButton: true, confirmButtonText: "Sim, apagar", cancelButtonText: "Cancelar" });
                if (!result.isConfirmed) return;

                const payload = ;

                try {
                    const resposta = await fetch("https://servidordomal.fun/api/mail", { method: "POST", headers: { "Content-Type": "application/json", "Authorization": token }, body: JSON.stringify({ action: "signoff" }), });

                    if (resposta.status === 200) { localStorage.removeItem("Mail-Token"); await Swal.fire("Conta apagada!", "Sua conta foi removida com sucesso.", "success"); window.location.href = "login"; } 
                    else { Swal.fire("Erro", "Erro ao apagar conta.", "error"); }
                } catch { Swal.fire("Erro", "Erro na conexão.", "error"); }
            });
        };
    </script>
</head>
<body>
    <div id="conteiner">
        <h2>Ações de Segurança</h2><br>
        <button id="back" type="submit">Retornar</button>
        <button id="changepass" type="submit">Trocar Senha</button>
        <button id="signout" type="submit">Encerrar sessão</button>
        <button id="signoff" type="submit">Apagar Conta</button>
    <div>
</body>
</html>
